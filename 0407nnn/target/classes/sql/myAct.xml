<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="myAct">
	<select id="count"  parameterType="String" resultType="int">
		select count(*) from board where USER_ID = #{myActUserId} 
	</select>
	
	<select id="myActBoardCategoryCount"  parameterType="map" resultType="int">
		select count(*) from board
		<where>
		<if test='category != null and category != ""'>
			AND B_CATEGORY = #{category} 
		</if>
		<if test='USER_ID != null and USER_ID != ""'>
			AND USER_ID = #{USER_ID} 
		</if>
		</where>
	</select>
	
	<!-- 나의 활동 게시글 select문 -->
	<select id="searchList" parameterType="map"
		resultType="hils.mypage2.model.MyActBoardDto">
		select b_number,b_category, user_id, b_reg_date, b_subject
		from (select b_number,b_category, user_id, b_reg_date, b_subject, rownum r
		from (select *
		from board
		<where>
		<if test='category != null and category != ""'>
			AND B_CATEGORY = #{category} 
		</if>
		<if test='myActUserId != null and myActUserId != ""'>
			AND USER_ID = #{myActUserId} 
		</if>
		</where>
		<include refid="search"></include>
		order by b_number desc) order by b_number desc)
		where r >= #{start} and r &lt;= #{end}
	</select>
	<sql id="search">
		<where>
			<if test='searchCategory != null and searchCategory != ""'>
				<if test="searchCategory == 'b_subject'.toString()">
					AND subject like '%' || #{searchWord} || '%'
				</if>
				<if test="searchCategory == 'b_content'.toString()">
					AND content like '%' || #{searchWord} || '%'
				</if>
			</if>
		</where>
	</sql>
	
	<select id="selectMyActBoardList" parameterType="map"
		resultType="hils.mypage2.model.MyActBoardDto">
		select b_number,b_category, user_id, b_reg_date, b_subject
		from (select b_number,b_category, user_id, b_reg_date, b_subject, rownum r
		from
		(select * from board order by B_NUMBER desc)
		<where>
		<if test='category != null and category != ""'>
			AND B_CATEGORY = #{category} 
		</if>
		<if test='USER_ID != null and USER_ID != ""'>
			AND USER_ID = #{USER_ID} 
		</if>
		</where>
		order by B_NUMBER desc)
		where r >= #{start_writing_num} and r
		&lt;= #{end_writing_num}
	</select>
	
	<select id="getPagingCategory" parameterType="map"
		resultType="int">
		select count(*) from board
		<where>
		<if test='category != null and category != ""'>
			AND B_CATEGORY = #{category} 
		</if>
		<if test='USER_ID != null and USER_ID != ""'>
			AND USER_ID = #{USER_ID} 
		</if>
		</where>
	</select>
	
	<select id = "selectCal" parameterType = "map" resultType = "hils.mypage2.model.MyActCalendarDto">
		select h.user_id, h.workout_key, h.workout_reg_date, cs.food_schedule_key from hellinder h join calory_schedular cs on h.user_id = cs.user_id
		AND h.workout_reg_date = cs.schedule_data 
		<where>
			<choose>
				<when test = "input_date != null">
					h.workout_reg_date between TRUNC(#{input_date}, 'MM') and LAST_DAY(#{input_date})
				</when>
				<otherwise>
					h.workout_reg_date between TRUNC(sysdate, 'MM') and LAST_DAY(sysdate)
				</otherwise>
			</choose>
			<if test = "user_id != '' and user_id != null">
				and h.user_id = #{user_id} 
			</if>
		</where>
	</select>
	
	<!-- 힐린더 mapper  -->
	<select id="latestdate" parameterType="String" resultType = "java.util.Date">
		select max(workout_reg_date) workout_reg_date from hellinder where user_id=#{user_id}
	</select>
	<select id="workoutInfo1" parameterType="hils.mypage2.model.ProfileDto"
	resultType="hils.Mypage1.controller.ProfileDto">
		select user_id, workout_key, workout_reg_date, workout_certi_path from hellinder
		where user_id=#{user_id} and workout_reg_date=#{workout_reg_date}
	</select>
	<select id="workoutInfo2" parameterType="hils.mypage2.model.ProfileDto"
	resultType="hils.Mypage1.controller.ProfileDto">
		select workout_name, workout_hours from workout_calendar_oneday
		where workout_key=#{workout_key}
	</select>
	<!-- 식단정보 -->
	<select id="dietInfo" parameterType="String" resultType="hils.mypage2.model.ProfileDto">
		select food_identifier, food_calory, food_amount, food_goal from calory_oneday_schedule
		where FOOD_SCHEDULE_KEY=#{workout_key}
	</select>
</mapper>