<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="myAct">
	<select id="count" resultType="int">
		select count(*) from board
	</select>
	
	<!-- 나의 활동 게시글 select문 -->
	<select id="searchList" parameterType="map"
		resultType="hils.mypage2.model.MyActBoardDto">
		select *
		from (select b_category, user_id, b_reg_date, b_subject, rownum r
		from (select *
		from board
		 where user_id = #{myActUserId}
		<include refid="search"></include>
		order by b_number desc) order by b_number desc)
		where r >= #{start} and r &lt;= #{end}
	</select>
	<sql id="search">
		<where>
			<if test='category != null and category != ""'>
				<if test="category == 'subject'.toString()">
					AND subject like '%' || #{searchWord} || '%'
				</if>
				<if test="category == 'content'.toString()">
					AND content like '%' || #{searchWord} || '%'
				</if>
			</if>
		</where>
	</sql>
	
	<select id = "selectCal" parameterType = "map" resultType = "hils.mypage2.model.MyActCalendarDto">
		select h.user_id, h.workout_key, h.workout_reg_date, cs.food_schedule_key from hellinder h join calory_schedular cs on h.user_id = cs.user_id
		AND h.workout_reg_date = cs.schedule_data 
		<where>
			<choose>
				<when test = "input_date != null">
					h.workout_reg_date between TRUNC(#{input_date}, 'MM') and LAST_DAY(#{input_date})
				</when>
				<otherwise>
					h.workout_reg_date between TRUNC(sysdate, 'MM') and LAST_DAY(sysdate)
				</otherwise>
			</choose>
			<if test = "user_id != '' and user_id != null">
				and h.user_id = #{user_id} 
			</if>
		</where>
	</select>
	
	<!-- 힐린더 mapper  -->
	<select id="latestdate" parameterType="String" resultType = "java.util.Date">
		select max(workout_reg_date) workout_reg_date from hellinder where user_id=#{user_id}
	</select>
	<select id="workoutInfo1" parameterType="hils.mypage2.model.ProfileDto"
	resultType="hils.Mypage1.controller.ProfileDto">
		select user_id, workout_key, workout_reg_date, workout_certi_path from hellinder
		where user_id=#{user_id} and workout_reg_date=#{workout_reg_date}
	</select>
	<select id="workoutInfo2" parameterType="hils.mypage2.model.ProfileDto"
	resultType="hils.Mypage1.controller.ProfileDto">
		select workout_name, workout_hours from workout_calendar_oneday
		where workout_key=#{workout_key}
	</select>
	<!-- 식단정보 -->
	<select id="dietInfo" parameterType="String" resultType="hils.mypage2.model.ProfileDto">
		select food_identifier, food_calory, food_amount, food_goal from calory_oneday_schedule
		where FOOD_SCHEDULE_KEY=#{workout_key}
	</select>
</mapper>